<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Leaf - Dashboard</title>

    <link rel="icon" href="../../assets/icon/logo.svg">
    <link rel="stylesheet" href="css/dashboardPage.css">

    <!-- SCRIPT PARA PUXAR A BIBLIOTECA DO CHARTJS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.8/css/line.css">
</head>

<body>
    <!-- PAG MENU -->
    <div class="container">

        <div class="lateral">
            <!-- parte de cima -->
            <div class="listaBaixo">
                <div class="navegacão">
                    <div class="navHeader">
                        <img src="../assets/icon/logo.svg">
                        <span>MENU</span>
                    </div>
                    <ul>
                        <li class="lista destaque">
                            <a href="dashboardPage.html">
                                <i class="uil uil-create-dashboard"></i>
                                <span class="lista">Dashboard</span>
                            </a>
                        </li>
                        <li class="lista">
                            <a href="estatisticaPage.html">
                                <i class="uil uil-presentation-line"></i>
                                <span class="lista">Estatística</span>
                            </a>
                        </li>
                        <!-- <li class="lista">
                            <a href="previsaoPage.html">
                                <i class="uil uil-chart-pie"></i>
                                <span class="lista">Previsões</span>
                            </a>
                        </li> -->
                        <li class="lista">
                            <a href="historicoPage.html">
                                <i class="uil uil-history"></i>
                                <span class="lista">Histórico</span>
                            </a>
                        </li>
                    </ul>
                    <div class="inferior-menu" style="background-image: url(../assets/imgs/VectorPéMenu.svg);">
                        <ul style="height: fit-content;">
                            <li class="lista">
                                <a href="cadastrarUsuario.html">
                                    <i class="uil uil-plus-circle"></i>
                                    <span class="lista" style="font-size: 15px;">Cadastrar usuario</span>
                                </a>
                            </li>
                            <li class="lista">
                                <a href="cadastrarEstufa.html">
                                    <i class="uil uil-plus-circle"></i>
                                    <span class="lista" style="font-size: 15px;">Cadastrar estufa</span>
                                </a>
                            </li>
                            <!-- <img src="imgs/VectorPéMenu.svg" alt=""> -->
                        </ul>
                    </div>

                </div>

                <!-- parte de baixo -->
                <!-- <div class="trindade">
                    <div class="configNomeimg">
                        <div class="nomeNome">
                            <img src="imgs/Ellipse2325.png">
                            <ul class="ul2">
                                <span class="ismalendas">
                                    <span>NomeUsuario</span>
                                    <span>NomeEmpresa</span>
                                </span>
                            </ul>
                        </div> -->

                <!-- <div class="configgg">
                            <a href="#">
                                <i class="uil uil-setting"></i>
                            </a>
                            <a href="../home/login.html">
                                <i class="uil uil-signout" style="color: #C63535;"></i>
                            </a>
                        </div>
                    </div>
                </div> -->
            </div>
        </div>
        <!-- FIM DO MENU -->

        <!-- parte do dash -->
        <div class="tela">
            <div class="top">
                <div class="top-left">
                    <span class="topo">Dashboard</span>
                </div>
                <div class="nomeNome">
                    <img src="../assets/imgs/Ellipse2325.png">
                    <ul class="ul2">
                        <span class="ismalendas">
                            <span id="loginUsuario"></span>
                            <span>NomeEmpresa</span>
                        </span>
                    </ul>
                </div>
            </div>
            <div class="areaDash">
                <div>
                    <div class="alertsParametro">
                        <div class="urgente">
                            <img src="../assets/imgs/vetorUrgente.svg">
                            <div class="span-urgente">
                                <span class="urgenteText">CRÍTICO</span>
                                <span>350lm - 450lm</span>
                                <span>650lm - 800lm</span>
                            </div>
                        </div>
                        <div class="preocupante">
                            <img src="../assets/imgs/VectorNewProcupante.svg" width="30px">
                            <div class="span-preocupante">
                                <span class="criticoText">PREOCUPANTE</span>
                                <span>450lm - 500lm</span>
                                <span>600lm - 650lm</span>
                            </div>
                        </div>
                        <!-- <div class="critico">
                            <img src="../imgs/vectorPreocupante.svg" width="30px">
                            <span class="preocupanteText">PREOCUPANTE</span>
                        </div> -->
                        <div class="adequado">
                            <img src="../assets/imgs/vetorAdequado.svg">
                            <div class="span-adequado">
                                <span class="adequadoText">ADEQUADO</span>
                                <span>500lm - 600lm</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tela-dashboard">






                <div class="daddy">
                    <div class="main">


                        <div class="containerChart">
                            <div class="tittle_chart">
                                <span>
                                    MEDIA DA LUMINOSIDADE DAS ESTUFAS NAS ULTIMAS 24H
                                </span>
                            </div>
                            <canvas id="myChart1"></canvas>
                        </div>
                        <!-- <div class="containerChart">
                        <div class="chartContainer">
                            <div class="grafico1">
                                <span class="title-Chart"></span>
                                <span class="subTittle-Chart">EM CADA ESTUFA</span>
                            </div>
                        </div>
                    </div> -->

                        <div class="rodape">
                            <div class="ajuste_pie">
                                <p>SITUAÇÃO DOS SETORES</p>
                                <div class="grafico_pie">
                                    <div class="teste">
                                        <canvas id="grafico_pizza"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="indice_luz_pai">
                                <div class="daddy_indice">
                                    <div class="alto_indice_luz">
                                        <div class="maior_indice_luz">
                                            MAIOR ÍNDICE DE LUZ CAPTADO <br>
                                            <p>820lm</p>
                                        </div>
                                        <div class="indicacao_estufa">
                                            Guimarães - setor 1
                                        </div>
                                        <span class="hora"><img src="../assets/imgs/relogio.svg">09:35
                                        </span>

                                    </div>
                                    <div class="baixo_indice_luz">
                                        <div class="menor_indice_luz">
                                            MENOR ÍNDICE DE LUZ CAPTADO<br>
                                            <p id="menorIndiceluz"></p>
                                            <div class="indicacao_estufa">
                                                Paulista - setor 02
                                            </div>
                                            <span style="color: #6D2D2D;" class="hora"><img
                                                    src="../assets/imgs/relogio.svg">08:20
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="alerta_estufas">
                                    <div class="ajuste">
                                        <div class="indicativo_alerta_estufas">
                                            Estufas com mais alertas
                                        </div>
                                        <div class="mencao_estufas">
                                            <div class="mencionar_estufa1">
                                                Antônio
                                            </div>
                                            <div class="mencionar_estufa2">
                                                Guimarães
                                            </div>
                                            <div class="mencionar_estufa3">
                                                Paulista
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ALERTA URGENTE -->
                    <div class="lado_direito">
                        <div class="tela-alertas">
                            <span class="title-alerta">ALERTAS</span>

                            <div class="listaScroller">
                                <a class="click-alert" href="setor1.html">
                                    <div class="containerAlert">
                                        <div class="alert">
                                            <div class="img">
                                                <img class="img-alert" src="../assets/imgs/alert-icon.svg" alt="">
                                            </div>
                                            <div
                                                style="display: flex; flex-direction: column; justify-content: center; gap: 10px; width: 205px;">
                                                <div class="urgenteEst">
                                                    <span class="urgente">ESTUFA GUIMARÃES</span>
                                                    <span class="urgente">SETOR 1</span>
                                                    <span>SUBSETOR 1</span>
                                                </div>

                                                <div class="alerts">
                                                    <div class="text-valores">
                                                        <span class="text-atual">ÍNDICE ATUAL: 300lm</span>
                                                    </div>
                                                    <div
                                                        style="display: flex; justify-content: space-between; width: 100%;">
                                                        <span class="text-parametro-urgente">IDEAL: 500 - 600</span>
                                                        <span class="hora"><img src="../assets/imgs/relogio.svg">09:35
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a class="click-alert" href="setor2.html">
                                    <div class="containerAlert">
                                        <div class="alert">
                                            <div class="img">
                                                <img class="img-alert" src="../assets/imgs/alert-icon.svg" alt="">
                                            </div>
                                            <div
                                                style="display: flex; flex-direction: column; justify-content: center; gap: 10px; width: 205px;">
                                                <div class="urgenteEst">
                                                    <span class="urgente">ESTUFA GUIMARÃES</span>
                                                    <span class="urgente">SETOR 2</span>
                                                    <span>SUBSETOR 1</span>
                                                </div>

                                                <div class="alerts">
                                                    <div class="text-valores">
                                                        <span class="text-atual">ÍNDICE ATUAL: 0lm</span>
                                                    </div>
                                                    <div
                                                        style="display: flex; justify-content: space-between; width: 100%;">
                                                        <span class="text-parametro-urgente">IDEAL: 500 - 600</span>
                                                        <span class="hora"><img src="../assets/imgs/relogio.svg">09:35
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a class="click-alert" href="setor1.html">
                                    <div class="containerAlert">
                                        <div class="alert">
                                            <div class="img">
                                                <img class="img-alert" src="../assets/imgs/alert-icon.svg" alt="">
                                            </div>
                                            <div
                                                style="display: flex; flex-direction: column; justify-content: center; gap: 10px; width: 205px;">
                                                <div class="urgenteEst">
                                                    <span class="urgente">ESTUFA GUIMARÃES</span>
                                                    <span class="urgente">SETOR 3</span>
                                                    <span>SUBSETOR 1</span>
                                                </div>

                                                <div class="alerts">
                                                    <div class="text-valores">
                                                        <span class="text-atual">ÍNDICE ATUAL: 0lm</span>
                                                    </div>
                                                    <div
                                                        style="display: flex; justify-content: space-between; width: 100%;">
                                                        <span class="text-parametro-urgente">IDEAL: 500 - 600</span>
                                                        <span class="hora"><img src="../assets/imgs/relogio.svg">09:35
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                                <a class="click-alert" href="setor2.html">
                                    <div class="containerAlert">
                                        <div class="alert">
                                            <div class="img">
                                                <img class="img-alert-critico" src="../assets/imgs/vetorUrgente.svg"
                                                    width="30px">
                                            </div>
                                            <div
                                                style="display: flex; flex-direction: column; justify-content: center; gap: 10px; width: 205px;">
                                                <div class="urgenteEst">
                                                    <span class="urgente">ESTUFA ANTÔNIO</span>
                                                    <span class="urgente">SETOR 2</span>
                                                    <span>SUBSETOR 1</span>
                                                </div>

                                                <div class="alerts">
                                                    <div class="text-valores">
                                                        <span class="text-atual">ÍNDICE ATUAL: 245lm</span>
                                                    </div>
                                                    <div
                                                        style="display: flex; justify-content: space-between; width: 100%;">
                                                        <span class="text-parametro-urgente">IDEAL: 500 - 600</span>
                                                        <span class="hora"><img src="../assets/imgs/relogio.svg">09:35
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a class="click-alert" href="setor2.html">
                                    <div class="containerAlert">
                                        <div class="alertCritico">
                                            <div class="img">
                                                <img class="img-alert-critico" src="../assets/imgs/vectorCritico.svg"
                                                    width="30px">
                                            </div>
                                            <div
                                                style="display: flex; flex-direction: column; justify-content: center; gap: 10px; width: 205px;">
                                                <div class="urgenteEst">
                                                    <span class="critico">ESTUFA ANTÔNIO</span>
                                                    <span class="critico">SETOR 3</span>
                                                    <span>SUBSETOR 1</span>
                                                </div>

                                                <div class="alerts">
                                                    <div class="text-valores">
                                                        <span class="text-atual-critico">ÍNDICE ATUAL: 245lm</span>
                                                    </div>
                                                    <div
                                                        style="display: flex; justify-content: space-between; width: 100%;">
                                                        <span class="text-parametro-urgente">IDEAL: 500 - 600</span>
                                                        <span class="hora"><img src="../assets/imgs/relogio.svg">09:35
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                                <a class="click-alert" href="setor2.html">
                                    <div class="containerAlert">
                                        <div class="alertPreocupante">
                                            <div class="img">
                                                <img class="img-alert-critico"
                                                    src="../assets/imgs/vectorPreocupante.svg" width="30px">
                                            </div>
                                            <div
                                                style="display: flex; flex-direction: column; justify-content: center; gap: 10px; width: 205px;">
                                                <div class="urgenteEst">
                                                    <span class="preocupante">ESTUFA ANTÔNIO</span>
                                                    <span class="preocupante">SETOR 4</span>
                                                    <span>SUBSETOR 1</span>
                                                </div>

                                                <div class="alerts">
                                                    <div class="text-valores">
                                                        <span class="text-atual-preocupante">ÍNDICE ATUAL:
                                                            470lm</span>
                                                    </div>
                                                    <div
                                                        style="display: flex; justify-content: space-between; width: 100%;">
                                                        <span class="text-parametro-urgente">IDEAL: 500 - 600</span>
                                                        <span class="hora"><img src="../assets/imgs/relogio.svg">09:35
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                                <a class="click-alert" href="setor2.html">
                                    <div class="containerAlert">
                                        <div class="alertPreocupante">
                                            <div class="img">
                                                <img class="img-alert-critico"
                                                    src="../assets/imgs/vectorPreocupante.svg" width="30px">
                                            </div>
                                            <div
                                                style="display: flex; flex-direction: column; justify-content: center; gap: 10px; width: 205px;">
                                                <div class="urgenteEst">
                                                    <span class="preocupante">ESTUFA ANTÔNIO</span>
                                                    <span class="preocupante">SETOR 1</span>
                                                    <span>SUBSETOR 1</span>
                                                </div>

                                                <div class="alerts">
                                                    <div class="text-valores">
                                                        <span class="text-atual-preocupante">ÍNDICE ATUAL:
                                                            460lm</span>
                                                    </div>
                                                    <div
                                                        style="display: flex; justify-content: space-between; width: 100%;">
                                                        <span class="text-parametro-urgente">IDEAL: 500 - 600</span>
                                                        <span class="hora"><img src="../assets/imgs/relogio.svg">09:35
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </a>

                            </div>

                            <!--ALERTA CRÍTICO -->


                            <!-- ALERTA CRÍTICO  -->

                            <!-- <a class="click-alert-critico" href="">
                            <div class="containerAlert">
                                <div class="alert-critico">
                                    <div class="img">
                                        <img class="img-alert" src="../../assets/imgs/vectorCritico.svg">
                                    </div>
                                    <div class="urgenteEst-critico">
                                        <span class="critico">ESTUFA 05 - SETOR X</span>
                                    </div>

                                    <div class="alerts">
                                        <div class="text-valores">
                                            <div>
                                                <span class="critico-valor">ÍNDICE ATUAL: 700</span>
                                            </div>
                                            <div>
                                                <span class="text-parametro-critico">IDEAL: 500 - 805</span>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a> -->

                            <!-- ALERTA PREOCUPANTE -->
                            <!-- <a class="click-alert-preocupante" href="">
                            <div class="containerAlert">
                                <div class="alert-preocupante">
                                    <div class="urgenteEst-preocupado">
                                        <img class="img-alert" src="../../assets/imgs/vectorPreocupante.svg" alt="">
                                        <span class="preocupante">ESTUFA 05 - SETOR X</span>
                                    </div>
                                    <div class="alerts-preocupante">
                                        <div class="text-valores">
                                            <div>
                                                <span class="preocupante-valor">ÍNDICE ATUAL: 470</span>
                                            </div>
                                            <div>
                                                <span class="text-parametro-preocupante">IDEAL: 500 - 805
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a> -->



                        </div>
                        <!-- <div class="alertas_rodape">
                        <div class="indicador_alertas">
                            <div class="alerta_urgente">
                                <div class="img_alert_all">
                                    <img src="alert-icon.svg">
                                </div>
                                <span> Urgente </span>
                            </div>
                            <div class="alerta_critico">
                                <div class="img_alert_all">
                                    <img src="../../assets/imgs/vectorCritico.svg">
                                </div>
                                <span> Crítico </span>
                            </div>
                            <div class="alerta_preocupante">
                                <div class="img_alert_all">
                                    <img src="../../assets/imgs/vectorPreocupante.svg">
                                </div>
                                <span>Preocupante</span>
                            </div>
                        </div>
                    </div> -->
                    </div>

                </div>
            </div>

        </div>



        <!-- <div>
            <canvas id="myChart2" style="position: relative; height:40vh; width:40vw"></canvas></canvas>
        </div> -->

</body>
<script>
    const labels = [
        '12:00',
        '13:00',
        '14:00',
        '15:00',
        '16:00',
        '17:00',
    ];

    const data = {
        labels: labels,
        datasets: [{
            label: 'Antônio',
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: [687, 700, 760, 850, 840, 930],
        },
        {
            label: 'Paulista',
            backgroundColor: 'rgb(148, 0, 211)',
            borderColor: 'rgb(148, 0, 211)',
            data: [520, 500, 700, 560, 610, 560],
        },
        {
            label: 'Guimarães',
            backgroundColor: 'rgb(18, 10, 143)',
            borderColor: 'rgb(18, 10, 143)',
            data: [200, 266, 200, 233, 166, 200],
        }
        ]
    };

    const config = {
        type: 'line',
        data: data,
        options: {}
    };
</script>

<script>
    const myChart1 = new Chart(
        document.getElementById('myChart1'),
        config
    );
    // const myChart2 = new Chart(
    //     document.getElementById('myChart2'),
    //     config
    // );
</script>

<script>
    const grafico_pie = document.getElementById('grafico_pizza');

    new Chart(grafico_pie, {
        type: 'doughnut',
        data: {
            labels: ['Setores urgentes', 'Setores críticos', 'Setores preocupantes', 'Setores adequados'],
            datasets: [{
                data: [4, 6, 2, 17],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>


<script>
    loginUsuario.innerHTML = sessionStorage.NOME_USUARIO

    let proximaAtualizacao;

    window.onload = obterDadosGraficos();

    function obterDadosGraficos() {
        obterDadosGrafico(1)
        obterDadosGrafico(2)
        obterDadosGrafico(3)
        obterDadosGrafico(4)
    }


    function obterDadosGrafico(idEstufa) {

        if (proximaAtualizacao != undefined) {
            clearTimeout(proximaAtualizacao);
        }

        fetch(`/leitura/ultimas/${idEmpresa}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    plotarGrafico(resposta, idEmpresa);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function plotarGrafico(resposta, idEmpresa) {

        console.log('iniciando plotagem do gráfico...');

        // Criando estrutura para plotar gráfico - labels
        let labels = [];

        // Criando estrutura para plotar gráfico - dados
        let dados = {
            labels: labels,
            datasets: [{
                label: 'Luminosidade',
                data: [],
                fill: false,
                borderColor: 'rgb(255, 99, 132)',
                tension: 0.1
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)


        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.momento_grafico);
            dados.datasets[0].data.push(registro.Luminosidade);
            // dados.datasets[1].data.push(registro.temperatura);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        // Criando estrutura para plotar gráfico - config
        const config = {
            type: 'line',
            data: dados,
        };

        // Adicionando gráfico criado em div na tela
        let myChart = new Chart(
            document.getElementById(`myChart1${idAquario}`),
            config
        );

        setTimeout(() => atualizarGrafico(idEmpresa, dados, myChart), 2000);
    }

    function atualizarGrafico(idEmpresa, dados, myChart) {



        fetch(`/leitura/tempo-real/${idEmpresa}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {

                    obterdados(idEmpresa);
                    // alertar(novoRegistro, idAquario);
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                    console.log(`Dados atuais do gráfico:`);
                    console.log(dados);

                    let avisoCaptura = document.getElementById(`avisoCaptura${idEmpresa}`)
                    avisoCaptura.innerHTML = ""


                    if (novoRegistro[0].momento_grafico == dados.labels[dados.labels.length - 1]) {
                        console.log("---------------------------------------------------------------")
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.")
                        avisoCaptura.innerHTML = "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará."
                        console.log("Horário do novo dado capturado:")
                        console.log(novoRegistro[0].momento_grafico)
                        console.log("Horário do último dado capturado:")
                        console.log(dados.labels[dados.labels.length - 1])
                        console.log("---------------------------------------------------------------")
                    } else {
                        // tirando e colocando valores no gráfico
                        dados.labels.shift(); // apagar o primeiro
                        dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

                        dados.datasets[0].data.shift();  // apagar o primeiro de umidade
                        dados.datasets[0].data.push(novoRegistro[0].umidade); // incluir uma nova medida de umidade

                        dados.datasets[1].data.shift();  // apagar o primeiro de temperatura
                        dados.datasets[1].data.push(novoRegistro[0].temperatura); // incluir uma nova medida de temperatura

                        myChart.update();
                    }

                    // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                    proximaAtualizacao = setTimeout(() => atualizarGrafico(idEmpresa, dados, myChart), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                proximaAtualizacao = setTimeout(() => atualizarGrafico(idEmpresa, dados, myChart), 2000);
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

    }


</script>

<script>
    loginUsuario.innerHTML = sessionStorage.NOME_USUARIO

    window.onload = obterDadosGraficos();

    function obterDadosGrafico() {
        obterDadosGrafico(1)
        obterDadosGrafico(2)
        obterDadosGrafico(3)
        obterDadosGrafico(4)
    }
    var idEmpresa = sessionStorage.idUsuario


    window.onload = coletarMenorIndice();
    function coletarMenorIndice() {
        fetch(`/leitura/coletarMenorIndice/${idEmpresa}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    menorIndiceLuz.innerHTML = `${json.valor}lm`
                })
            }
        })

        fetch(`/leitura/ultimas/${idAquario}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    plotarGrafico(resposta, idAquario);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    window.onload = coletarMaiorIndice();
    function coletarMaiorIndice() {
        fetch(`/leitura/coletarMaiorIndice${idUsuario}`, {
            method: "GET",
            headers: {
                "Content-Type": "aplication/json"
            },
            body: JSON.stringify({
                idUsuarioServer: idUsuario
            })
        }).then(function (resposta) {
            console.log("resposta: ", resposta);

        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
        return false;
    }
</script>

</html>